---
name: init-catalog
description: Bootstrap .incidentfox.yaml by scanning your Kubernetes infrastructure. Creates an initial service catalog with discovered services, namespaces, and deployments.
---

# Initialize Service Catalog

You are helping the user create their initial `.incidentfox.yaml` service catalog by scanning their infrastructure.

## Process

### Step 1: Scan Infrastructure

Discover services from Kubernetes:

```
# List pods across namespaces to find services
list_pods(namespace="default")

# If the user has multiple namespaces, scan them too
# Common namespaces: default, production, staging, kube-system
```

For each discovered service pattern (e.g., `payment-api-xxx-yyy` â†’ `payment-api`):
- Extract the service name from pod names
- Note the namespace
- Note deployment names if visible

### Step 2: Build Service Entries

For each discovered service, create a YAML entry:

```yaml
services:
  <service-name>:
    description: ""  # User should fill in
    team: ""         # User should fill in
    criticality: P3  # Default, user should adjust
    namespace: <discovered-namespace>
    deployments: [<discovered-deployments>]
    dependencies: []  # User should fill in
```

### Step 3: Generate the YAML File

Create a complete `.incidentfox.yaml` with:
1. All discovered services
2. Placeholder sections for user to fill in
3. Empty `known_issues` array
4. Helpful comments

### Step 4: Present to User

Show the generated YAML and ask:
- "I discovered N services in your cluster. Here's the generated .incidentfox.yaml"
- "Would you like me to save this file? You can customize it afterward."

If user approves, write the file to `.incidentfox.yaml` in the current directory.

## Example Output

```yaml
# IncidentFox Service Catalog
# Generated by /init-catalog
# Customize this file to improve incident investigations

services:
  payment-api:
    description: ""  # TODO: Describe what this service does
    team: ""         # TODO: Which team owns this?
    criticality: P3  # TODO: Adjust priority (P1=critical, P4=low)

    namespace: production
    deployments: [payment-api]
    dependencies: []  # TODO: What does this service depend on?

    # Uncomment and configure observability:
    # logs:
    #   datadog: "service:payment-api"
    #   cloudwatch: "/aws/eks/payment-api"
    # dashboards:
    #   grafana: "https://grafana.example.com/d/xxx"
    # oncall:
    #   slack: "#payment-oncall"

  user-service:
    description: ""
    team: ""
    criticality: P3
    namespace: production
    deployments: [user-service]
    dependencies: []

# Known issues will be populated as you investigate incidents
# Use /sync-catalog to add discovered patterns
known_issues: []
```

## Important Notes

- **Don't overwrite existing files** - If `.incidentfox.yaml` already exists, show the user what would change and ask for confirmation
- **Start simple** - Only include fields that have values. Users can add more later.
- **Scan common namespaces** - Try `default`, `production`, `staging` if no namespace is specified
- **Be conservative** - Only include services you're confident about
